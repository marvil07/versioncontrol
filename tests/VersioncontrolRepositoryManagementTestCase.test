<?php
class VersioncontrolRepositoryManagementTestCase extends DrupalWebTestCase {

  protected $admin_user;

  /**
   * Implementation of getInfo().
   */
  public static function getInfo() {
    return array(
      'name' => t('Version Control Repository Management funcional testing'),
      'description' => t('Functional test for Repository management.'),
      'group' => t('Version Control'),
    );
  }

  /**
   * Implementation of setUp().
   */
  function setUp() {
    // load core and fake test backend modules
    parent::setUp('versioncontrol', 'versioncontrol_test');

    // Create and login the admin user
    $this->admin_user = $this->drupalCreateUser(array('administer version control systems'));
    $this->drupalLogin($this->admin_user);
  }

  public function testAddRepository() {
    // check missing name
    $edit = array();
    $this->drupalPost('admin/project/versioncontrol-repositories/add-test', $edit, t('Save repository'));
    $this->assertText('Repository name field is required.', 'Name field required failed');

    // minimal repo
    $edit = array(
      'repo_name' => 'Test repo ' . $this->randomName(),
      'root' => '/one/root',
      );
    $this->drupalPost('admin/project/versioncontrol-repositories/add-test', $edit, t('Save repository'));
    $this->assertRaw(t('The %repository repository has been added.', array('%repository' => $edit['repo_name'])), 'Reposiory add failed.');
  }

  public function testDeleteRepository() {
    // create a minimal repo and delete it
    $edit = array(
      'repo_name' => 'Test repo ' . $this->randomName(),
      'root' => '/one/root',
      );
    $this->drupalPost('admin/project/versioncontrol-repositories/add-test', $edit, t('Save repository'));
    $this->clickLink(t('Delete'));
    $this->drupalPost($this->url, array(), t('Delete'));
    $this->assertRaw(t('The %repository repository has been deleted.', array('%repository' => $edit['repo_name'])), 'Delete repository failed.');
  }

}
